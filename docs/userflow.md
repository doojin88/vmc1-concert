# User Flow: 콘서트 예약 웹앱

## 개요

본 문서는 콘서트 예약 시스템의 기능 단위 유저플로우를 정의합니다. 각 플로우는 입력-처리-출력 단계로 구성되며, 발생 가능한 엣지케이스에 대한 대응 방안을 포함합니다.

---

## UF-001: 콘서트 목록 조회

### 입력
- 사용자가 콘서트 목록 페이지(`/concerts`)에 진입

### 처리
1. 페이지 마운트 시 콘서트 목록 API 요청
2. 서버에서 예약 가능한 콘서트 데이터 조회
   - 콘서트 정보 (ID, 공연명, 일시, 공연장명)
   - 공연장 정보 (주소, 총 좌석 수)
   - 예약 현황 (현재 예약 인원)
3. 데이터를 카드 형식으로 렌더링
   - 공연 포스터 이미지
   - 공연명
   - 날짜 및 시간
   - 공연 장소
   - 예약 현황 (n/총좌석수)
4. 그리드 레이아웃으로 카드 목록 표시

### 출력
- **성공**: 콘서트 목록 카드 표시
- **실패 (네트워크 오류)**: 에러 메시지 표시 및 재시도 버튼 제공
- **실패 (데이터 없음)**: 예약 가능한 콘서트가 없다는 안내 메시지 표시

### 엣지케이스
- **케이스 1**: 콘서트 목록이 비어있을 때
  - 처리: 안내 메시지 표시
- **케이스 2**: 이미지 로드 실패
  - 처리: 기본 placeholder 이미지 표시
- **케이스 3**: API 응답 지연
  - 처리: 로딩 스피너 표시 (3초 이상 시 타임아웃 처리)
- **케이스 4**: 예약이 마감된 콘서트
  - 처리: 카드에 마감 표시 (클릭 불가능 상태로 UI 변경)

---

## UF-002: 콘서트 상세 조회

### 입력
- 사용자가 콘서트 카드 클릭
- 콘서트 ID를 URL 파라미터로 전달

### 처리
1. 콘서트 상세 페이지(`/concerts/:id`) 진입
2. 콘서트 ID로 상세 정보 API 요청
3. 서버에서 데이터 조회
   - 콘서트 정보 (공연명, 일시, 공연장명, 상세 설명, 포스터 URL)
   - 공연장 정보 (주소, 좌석 구성)
   - 좌석 등급별 정보 (등급명, 가격, 총 좌석 수, 예약 수)
4. 데이터를 섹션별로 렌더링
   - 콘서트 정보 섹션
   - 공연장 정보 섹션
   - 좌석 등급 정보 섹션 (등급별 가격 및 잔여석 표시)
5. 좌석 선택 버튼 활성화 상태 확인
   - 잔여석이 있으면 활성화
   - 매진 시 비활성화

### 출력
- **성공**: 콘서트 상세 정보 표시 및 좌석 선택 버튼 제공
- **실패 (콘서트 없음)**: 404 에러 페이지 표시 및 목록으로 돌아가기 버튼 제공
- **실패 (네트워크 오류)**: 에러 메시지 및 재시도 버튼 제공

### 엣지케이스
- **케이스 1**: 존재하지 않는 콘서트 ID
  - 처리: 404 페이지 표시, 콘서트 목록으로 이동 버튼 제공
- **케이스 2**: 콘서트가 매진된 경우
  - 처리: 좌석 선택 버튼 비활성화 및 매진 안내 표시
- **케이스 3**: 콘서트 일시가 과거인 경우
  - 처리: 예약 불가 안내 메시지 표시
- **케이스 4**: 이미지(포스터) 로드 실패
  - 처리: 기본 placeholder 이미지 표시

---

## UF-003: 좌석 선택

### 입력
- 사용자가 "좌석 선택하기" 버튼 클릭
- 좌석 맵에서 개별 좌석 클릭 (선택/해제)

### 처리
1. 좌석 선택 페이지(`/concerts/:id/seats`) 진입
2. 좌석 데이터 API 요청
3. 서버에서 좌석 현황 조회
   - 각 좌석의 상태 (예약 가능/예약됨/선택됨)
   - 좌석 정보 (구역, 행, 열, 등급, 가격)
4. 좌석 맵 렌더링
   - 4개 구역 (A, B, C, D) 시각화
   - 각 구역: 4행 × 20열
   - 좌석 등급별 색상 구분
   - 상태별 스타일 적용
5. 좌석 클릭 시 이벤트 처리
   - **예약 가능 좌석 클릭**: Context의 `selectSeat` 액션 디스패치
   - **선택된 좌석 클릭**: Context의 `deselectSeat` 액션 디스패치
   - **예약된 좌석 클릭**: 클릭 무시 (안내 툴팁 표시)
6. Context Store 상태 업데이트
   - `selectedSeats` 배열에 좌석 추가/제거
   - `totalAmount` 자동 계산
7. 선택 정보 패널 실시간 업데이트
   - 선택된 좌석 목록
   - 총 금액
8. 예약하기 버튼 활성화 조건 확인
   - 최소 1석 이상 선택 시 활성화

### 출력
- **성공 (좌석 선택)**: 선택된 좌석 시각적 피드백 및 선택 정보 패널 업데이트
- **성공 (좌석 해제)**: 선택 해제 시각적 피드백 및 선택 정보 패널 업데이트
- **실패 (예약된 좌석 클릭)**: 예약 불가 안내 툴팁 표시
- **실패 (네트워크 오류)**: 에러 메시지 및 재시도 버튼 제공

### 엣지케이스
- **케이스 1**: 좌석을 선택하지 않고 예약하기 버튼 클릭
  - 처리: 버튼 비활성화 상태 유지
- **케이스 2**: 다른 사용자가 먼저 선택한 좌석을 클릭
  - 처리: 좌석 상태 실시간 동기화, 예약됨 상태로 표시 및 선택 불가 안내
- **케이스 3**: 좌석 선택 중 세션 타임아웃 (5분)
  - 처리: 임시 잠금 해제 안내 및 다시 선택하도록 유도
- **케이스 4**: 최대 선택 가능 좌석 수 초과 (제한이 있는 경우)
  - 처리: 추가 선택 불가 안내 메시지 표시
- **케이스 5**: 페이지 이탈 시 선택한 좌석 데이터
  - 처리: Context에 저장된 상태 유지 (새로고침 시에는 초기화)
- **케이스 6**: 좌석 데이터 로드 실패
  - 처리: 에러 메시지 및 이전 페이지로 돌아가기 버튼 제공

---

## UF-004: 예약 정보 입력

### 입력
- 사용자가 "예약하기" 버튼 클릭
- 예약자명 입력 (텍스트)
- 휴대폰번호 입력 (숫자)
- 비밀번호 입력 (숫자 4자리)
- "이전" 버튼 클릭 (옵션)
- "예약 완료" 버튼 클릭

### 처리
1. 예약 정보 입력 페이지(`/concerts/:id/booking`) 진입
2. Context에서 선택된 좌석 정보 조회
3. 선택 좌석 요약 정보 표시
   - 선택한 좌석 수
   - 선택한 좌석 내역 (구역-행-열 형식)
   - 총 금액
4. 입력 필드별 실시간 유효성 검증
   - **예약자명**: 
     - 필수 입력 확인
     - 2자 이상, 20자 이하 확인
   - **휴대폰번호**: 
     - 필수 입력 확인
     - 숫자만 입력 허용 (하이픈 자동 제거)
     - 10~11자리 확인
     - 형식 검증 (01로 시작)
   - **비밀번호**: 
     - 필수 입력 확인
     - 숫자 4자리 확인
5. "이전" 버튼 클릭 시
   - 좌석 선택 페이지로 이동
   - Context 상태 유지 (선택한 좌석 유지)
6. "예약 완료" 버튼 클릭 시
   - 모든 필드 유효성 검증
   - 예약 생성 API 요청
   - 서버에서 처리:
     - 선택된 좌석 예약 가능 여부 재확인
     - 예약 레코드 생성
     - 좌석 상태 RESERVED로 변경
     - 예약 번호 생성
   - Context 상태 초기화 준비

### 출력
- **성공 (입력 중)**: 실시간 유효성 검증 피드백 (에러 메시지 또는 성공 표시)
- **성공 (예약 완료)**: 예약 완료 페이지로 이동 및 예약 번호 전달
- **실패 (유효성 검증 실패)**: 해당 필드 하단에 에러 메시지 표시
- **실패 (좌석 중복 예약)**: 알림 모달 표시 및 좌석 선택 페이지로 이동
- **실패 (네트워크 오류)**: 에러 메시지 및 재시도 버튼 제공

### 엣지케이스
- **케이스 1**: 필수 필드 미입력 상태에서 제출
  - 처리: 예약 완료 버튼 비활성화 또는 에러 메시지 표시
- **케이스 2**: 휴대폰번호에 하이픈 포함 입력
  - 처리: 자동으로 하이픈 제거 후 유효성 검증
- **케이스 3**: 비밀번호에 숫자 외 문자 입력
  - 처리: 숫자만 입력 허용 (입력 자체를 차단)
- **케이스 4**: 예약 처리 중 다른 사용자가 동일 좌석 예약
  - 처리: 예약 실패 안내, 선택한 좌석 중 예약된 좌석 표시, 좌석 선택 페이지로 이동
- **케이스 5**: 예약자명에 특수문자 입력
  - 처리: 특수문자 입력 허용 (유효성 검증에서 길이만 확인)
- **케이스 6**: Context에 선택된 좌석이 없는 경우
  - 처리: 좌석 선택 페이지로 리다이렉트
- **케이스 7**: 예약 API 요청 중 타임아웃
  - 처리: 타임아웃 에러 메시지 표시, 재시도 버튼 제공

---

## UF-005: 예약 완료 확인

### 입력
- 예약 정보 입력 플로우에서 성공적으로 예약 완료
- 예약 번호 및 예약 정보를 props 또는 Context로 전달받음

### 처리
1. 예약 완료 페이지(`/concerts/:id/confirmation`) 진입
2. 예약 정보 표시
   - 예약 완료 메시지
   - 예약 번호
   - 콘서트 정보 요약 (공연명, 일시, 공연장)
   - 예약된 좌석 정보 (구역-행-열 목록)
   - 예약자 정보 (이름, 휴대폰번호)
   - 총 결제 금액
3. Context Store 초기화
   - `selectedSeats` 배열 초기화
   - `totalAmount` 0으로 리셋
4. 네비게이션 버튼 제공
   - "홈으로" 버튼: 콘서트 목록 페이지로 이동
   - "예약 조회" 버튼: 예약 조회 페이지로 이동

### 출력
- **성공**: 예약 완료 정보 표시 및 네비게이션 버튼 제공
- **실패 (데이터 없음)**: 예약 정보를 찾을 수 없다는 메시지 및 홈으로 버튼 제공

### 엣지케이스
- **케이스 1**: 예약 정보 없이 직접 URL 접근
  - 처리: 예약 번호가 없으면 콘서트 목록으로 리다이렉트
- **케이스 2**: 페이지 새로고침
  - 처리: URL에 예약 번호가 있으면 API로 예약 정보 재조회, 없으면 홈으로 이동
- **케이스 3**: 뒤로가기 버튼 클릭
  - 처리: 예약 정보 입력 페이지로 이동하지 않도록 히스토리 관리 (replace 사용)

---

## UF-006: 예약 조회

### 입력
- 사용자가 예약 조회 페이지(`/reservations`) 진입
- 휴대폰번호 입력 (숫자)
- 비밀번호 입력 (숫자 4자리)
- "조회하기" 버튼 클릭

### 처리
1. 예약 조회 페이지 진입
2. 조회 폼 렌더링
3. 입력 필드별 실시간 유효성 검증
   - **휴대폰번호**: 
     - 필수 입력 확인
     - 숫자만 입력 허용
     - 10~11자리 확인
   - **비밀번호**: 
     - 필수 입력 확인
     - 숫자 4자리 확인
4. "조회하기" 버튼 클릭 시
   - 모든 필드 유효성 검증
   - 예약 조회 API 요청
   - 서버에서 처리:
     - 휴대폰번호와 비밀번호로 예약 정보 조회
     - 비밀번호 해시 비교
     - 일치하는 예약 정보 반환
5. 조회 결과 렌더링
   - 예약 번호
   - 콘서트 정보 (공연명, 일시, 공연장)
   - 예약된 좌석 정보 (구역-행-열 목록)
   - 예약자 정보 (이름, 휴대폰번호)
   - 예약 일시
   - 총 결제 금액

### 출력
- **성공**: 예약 정보 표시
- **실패 (일치하는 예약 없음)**: 조회 결과가 없다는 안내 메시지 표시
- **실패 (비밀번호 불일치)**: 비밀번호가 일치하지 않는다는 에러 메시지 표시
- **실패 (유효성 검증 실패)**: 해당 필드 하단에 에러 메시지 표시
- **실패 (네트워크 오류)**: 에러 메시지 및 재시도 버튼 제공

### 엣지케이스
- **케이스 1**: 필수 필드 미입력 상태에서 조회
  - 처리: 조회하기 버튼 비활성화 또는 에러 메시지 표시
- **케이스 2**: 존재하지 않는 휴대폰번호 입력
  - 처리: 조회 결과 없음 안내 메시지 표시
- **케이스 3**: 비밀번호 불일치
  - 처리: 비밀번호 오류 메시지 표시 (보안을 위해 구체적 정보 노출 최소화)
- **케이스 4**: 여러 개의 예약이 있는 경우
  - 처리: 모든 예약 목록 표시 (최신순 정렬)
- **케이스 5**: 취소된 예약 조회
  - 처리: 예약 상태 표시 (취소됨) 및 취소 일시 표시
- **케이스 6**: 과거 콘서트 예약 조회
  - 처리: 정상 표시, 콘서트 종료 여부 표시

---

## UF-007: 좌석 선택에서 예약 정보 입력으로 이동

### 입력
- 사용자가 좌석 선택 페이지에서 "예약하기" 버튼 클릭

### 처리
1. Context에서 선택된 좌석 확인
2. 선택된 좌석이 있는지 검증
   - 선택된 좌석 배열 길이 확인
3. 선택된 좌석이 있으면:
   - 예약 정보 입력 페이지(`/concerts/:id/booking`)로 이동
   - Context 상태 유지
4. 선택된 좌석이 없으면:
   - 이동하지 않음

### 출력
- **성공 (좌석 선택됨)**: 예약 정보 입력 페이지로 이동
- **실패 (좌석 미선택)**: 좌석 선택 요청 안내 메시지 표시 (토스트 또는 알림)

### 엣지케이스
- **케이스 1**: 선택한 좌석이 없는 상태에서 버튼 클릭
  - 처리: 버튼 비활성화 상태 유지
- **케이스 2**: Context 상태가 초기화된 경우
  - 처리: 좌석 선택 페이지로 리다이렉트

---

## UF-008: 예약 정보 입력에서 좌석 선택으로 돌아가기

### 입력
- 사용자가 예약 정보 입력 페이지에서 "이전" 버튼 클릭

### 처리
1. 현재 입력된 폼 데이터 확인
2. Context 상태 유지 (선택된 좌석 정보)
3. 좌석 선택 페이지(`/concerts/:id/seats`)로 이동
4. 이전에 선택했던 좌석 상태 복원
   - Context에 저장된 `selectedSeats` 배열 기반으로 UI 렌더링

### 출력
- **성공**: 좌석 선택 페이지로 이동, 이전 선택 상태 복원

### 엣지케이스
- **케이스 1**: 입력 중인 데이터가 있는 경우
  - 처리: 데이터 손실 경고 없이 이동 (Context 상태는 유지)
- **케이스 2**: Context에 선택된 좌석이 없는 경우
  - 처리: 빈 상태로 좌석 선택 페이지 표시

---

## UF-009: 페이지 새로고침 시 상태 처리

### 입력
- 사용자가 브라우저 새로고침 (F5 또는 Cmd+R)

### 처리
1. Context 상태 확인
   - 새로고침 시 Context Store 초기화됨
2. 현재 페이지 URL 확인
3. 페이지별 처리:
   - **콘서트 목록/상세**: 정상 렌더링 (API 재요청)
   - **좌석 선택**: 정상 렌더링, 선택된 좌석 없는 상태
   - **예약 정보 입력**: Context 상태 없음 → 좌석 선택 페이지로 리다이렉트
   - **예약 완료**: URL에 예약 번호 있으면 API 재조회, 없으면 홈으로 리다이렉트
   - **예약 조회**: 정상 렌더링, 빈 폼 상태

### 출력
- **페이지별 적절한 상태로 렌더링 또는 리다이렉트**

### 엣지케이스
- **케이스 1**: 좌석 선택 중 새로고침
  - 처리: 선택한 좌석 정보 손실, 처음부터 다시 선택
- **케이스 2**: 예약 정보 입력 중 새로고침
  - 처리: 좌석 선택 페이지로 리다이렉트

---

## UF-010: 동시 예약 충돌 처리

### 입력
- 사용자 A가 좌석 선택 및 예약 진행 중
- 사용자 B가 동일 좌석 선택 및 예약 시도

### 처리
1. **좌석 선택 단계**:
   - 사용자 A가 좌석 선택 → Context에 저장 (서버에 임시 잠금 요청)
   - 서버에서 임시 잠금 처리 (5분간 유효)
   - 사용자 B가 동일 좌석 클릭 시도
   - 서버에서 잠금 상태 확인
   - 선택 불가 상태로 응답
2. **예약 완료 단계**:
   - 사용자 A가 예약 완료 버튼 클릭
   - 서버에서 좌석 상태를 RESERVED로 변경
   - 사용자 B가 예약 완료 시도
   - 서버에서 좌석 상태 재확인
   - 이미 예약됨 상태 감지
   - 예약 실패 응답
3. **임시 잠금 타임아웃**:
   - 5분 경과 시 임시 잠금 자동 해제
   - 좌석 상태 AVAILABLE로 복원

### 출력
- **성공 (먼저 예약한 사용자)**: 예약 완료
- **실패 (나중에 시도한 사용자)**: 예약 불가 안내, 좌석 선택 페이지로 이동

### 엣지케이스
- **케이스 1**: 사용자 A가 임시 잠금 후 5분 경과
  - 처리: 타임아웃 안내 메시지, 좌석 재선택 유도
- **케이스 2**: 사용자 B가 임시 잠금된 좌석 선택 시도
  - 처리: 선택 불가 안내 (다른 사용자가 선택 중)
- **케이스 3**: 예약 API 요청 중 좌석 상태 변경
  - 처리: 예약 실패 응답, 최신 좌석 현황 재조회, 좌석 선택 페이지로 이동

---

## UF-011: 네트워크 오류 처리

### 입력
- API 요청 중 네트워크 오류 발생

### 처리
1. API 요청 실행
2. 네트워크 오류 감지
   - 타임아웃 (30초)
   - 연결 실패
   - 서버 오류 (5xx)
3. 오류 타입별 처리
   - **타임아웃**: 재시도 로직 실행 (최대 3회)
   - **연결 실패**: 즉시 에러 표시
   - **서버 오류**: 즉시 에러 표시
4. 사용자에게 에러 메시지 표시
5. 재시도 버튼 제공

### 출력
- **에러 메시지 표시**
- **재시도 버튼 제공**
- **이전 페이지로 돌아가기 버튼 제공 (선택적)**

### 엣지케이스
- **케이스 1**: 예약 완료 API 요청 중 오류
  - 처리: 예약 상태 불명확 안내, 예약 조회 유도
- **케이스 2**: 좌석 조회 API 요청 중 오류
  - 처리: 에러 메시지 및 재시도, 또는 이전 페이지로 이동
- **케이스 3**: 반복적인 재시도 실패
  - 처리: 시스템 점검 안내 메시지, 관리자 연락처 제공

---

## UF-012: 유효성 검증 실패 처리

### 입력
- 사용자가 잘못된 형식의 데이터 입력
- 폼 제출 시도

### 처리
1. 클라이언트 측 실시간 유효성 검증
   - onChange 이벤트에서 필드별 검증
   - 유효하지 않은 경우 에러 상태 설정
2. 폼 제출 시 전체 필드 재검증
3. 유효하지 않은 필드가 있으면:
   - 제출 차단
   - 에러 메시지 표시
   - 첫 번째 에러 필드로 포커스 이동
4. 모든 필드가 유효하면:
   - API 요청 진행

### 출력
- **실패**: 해당 필드 하단에 에러 메시지 표시
- **성공**: 제출 진행

### 엣지케이스
- **케이스 1**: 예약자명이 너무 짧거나 긴 경우
  - 처리: 길이 에러 메시지 표시
- **케이스 2**: 휴대폰번호가 올바른 형식이 아닌 경우
  - 처리: 형식 에러 메시지 표시
- **케이스 3**: 비밀번호가 4자리가 아닌 경우
  - 처리: 길이 에러 메시지 표시
- **케이스 4**: 특수문자나 이모지 입력
  - 처리: 필드별 입력 허용 정책에 따라 처리

---

## 플로우 다이어그램

### 예약 메인 플로우
```
[UF-001: 콘서트 목록 조회]
         ↓
[UF-002: 콘서트 상세 조회]
         ↓
[UF-003: 좌석 선택] ←──────┐
         ↓                  │
         │                  │
    [UF-007: 예약하기]      │
         ↓                  │
[UF-004: 예약 정보 입력]    │
         ↓                  │
    [UF-008: 이전] ─────────┘
         │
         ↓
[UF-005: 예약 완료 확인]
```

### 예약 조회 플로우
```
[UF-006: 예약 조회]
         ↓
[조회 결과 표시]
```

### 공통 플로우
```
[모든 페이지]
    ↓
[UF-009: 페이지 새로고침]
    ↓
[상태 복원 또는 리다이렉트]

[좌석 선택/예약]
    ↓
[UF-010: 동시 예약 충돌]
    ↓
[충돌 해결]

[모든 API 요청]
    ↓
[UF-011: 네트워크 오류]
    ↓
[재시도 또는 에러 처리]

[모든 폼 입력]
    ↓
[UF-012: 유효성 검증]
    ↓
[성공 또는 에러 표시]
```

---

## 부록: 상태 전이도

### 좌석 상태 전이
```
[AVAILABLE]
    ↓ (사용자가 선택)
[SELECTED] → 임시 잠금 (5분)
    ↓ (예약 완료)
[RESERVED]

[SELECTED]
    ↓ (타임아웃 또는 선택 해제)
[AVAILABLE]
```

### Context Store 상태 전이
```
[초기 상태]
selectedSeats: []
totalAmount: 0

    ↓ (좌석 선택)

[좌석 선택 상태]
selectedSeats: [seat1, seat2, ...]
totalAmount: sum(seats.price)

    ↓ (예약 완료)

[초기 상태로 리셋]
selectedSeats: []
totalAmount: 0
```

---

**문서 버전**: 1.0  
**작성일**: 2025-10-15  
**최종 수정일**: 2025-10-15

